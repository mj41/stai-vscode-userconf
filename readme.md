# stai-vscode-userconf

If `stai-vscode-userconf` directory exists, it will automatically adjust your VS Code workspace and settings using the provided `.merge` templates.

Minimal user layer for adjusting VS Code workspace and settings via `.merge` templates (only mechanism supported).

Supported templates:
- `app-settings.json.merge.tmpl`
- `user-settings.json.merge.tmpl`
- `keybindings.json.merge.tmpl`
- `stai-all.code-workspace.merge.tmpl`

These will be merged to default `stai-vscode` templates in `cmd/ws-config-gen/templates/`.

## Merge rules
- File name must be the name of original template plus '.merge.tmpl' suffix instead of '.json.tmpl' suffix.
- Object + object: deep merge; later leaf wins.
- Array + array: append new items (existing first, then incoming). No dedupe.
- Scalar: later value overrides.
- Type change: error.

## Supported structures
- Root / nested JSON objects.
- Arrays of objects (e.g. `folders`).
- Arrays of objects or scalars.

Unsupported / avoid:
- Arrays of arrays.
- Mixed element types inside one array.

## Common tasks & examples

Adds or overrides a scalar setting:
```json
{ "window.zoomLevel": 2 }
```

Extend nested approvals:
```json
{
	"chat.tools.terminal.autoApprove": {
		"make setup": true,
		"go run ./cmd/*": true
	}
}
```

Append to (hypothetical) extensions list:
```json
{ "extensions": ["ms-vscode.go", "github.copilot"] }
```

Append workspace folders after template variables are generated:
```json
{
	"folders": [
		{ "path": "{{.RegularRepoPrefix}}/mj.noai" },
		{ "path": "{{.RegularRepoPrefix}}/stai-vscode" }
	]
}
```

## Settings file locations
- App-level settings (merged app-settings): `profiles-stai/insiders-A/user-data/User/settings.json`
- User-profile specific settings (merged user-settings layer): `profiles-stai/insiders-A/user-data/User/profiles/-<profile-hash>/settings.json`

The hash segment is generated by VS Code for the profile. Use the top-level settings.json for global (per generated profile) adjustments; use the hashed profile path for per-profile UI overrides if needed.

## ws-config-gen.json.tmpl

Configuration template for `ws-config-gen` tool settings (not VS Code settings).

### File locations

1. **Common**: `stai-vscode-userconf/common/ws-config-gen.json.tmpl`
2. **Per-profile**: `stai-vscode-userconf/<profile>/ws-config-gen.json.tmpl` (e.g., `insiders-E/ws-config-gen.json.tmpl`)

Per-profile settings override common settings.

### Template variables

The file supports the same template variables as other templates:
- `{{.BaseDir}}` — base working directory (e.g., `/home/stai/work-stai`)
- `{{.DirName}}` — profile directory name (e.g., `insiders-E`)
- `{{.LetterUpper}}` — profile letter uppercase (e.g., `E`)
- `{{.LetterLower}}` — profile letter lowercase (e.g., `e`)

### Supported options

| Key | Default | Description |
|-----|---------|-------------|
| `vscodeBinary` | `{{.BaseDir}}/opt/code-insiders` | Full path to VS Code binary |

### Example: Use patched VS Code binary

`stai-vscode-userconf/common/ws-config-gen.json.tmpl`:
```json
{
  "vscodeBinary": "{{.BaseDir}}/opt/code-insiders-stai"
}
```

This affects `.desktop` files, `.bashrc-stai` aliases, and extension installation.

